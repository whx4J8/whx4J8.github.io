<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="spring," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="dubbo对spring的标签的扩展&amp;lt;dubbo:application name=&amp;quot;${dubbo.application.name}&amp;quot; owner=&amp;quot;whx&amp;quot; organization=&amp;quot;whx-inc&amp;quot;/&amp;gt;
&amp;lt;dubbo:registry protocol=&amp;quot;zookeeper&amp;quot;">
<meta property="og:type" content="article">
<meta property="og:title" content="dubbo学习-spring schema扩展">
<meta property="og:url" content="http://yoursite.com/2017/06/02/dubbo学习-spring-schema扩展/index.html">
<meta property="og:site_name" content="学而后知不足">
<meta property="og:description" content="dubbo对spring的标签的扩展&amp;lt;dubbo:application name=&amp;quot;${dubbo.application.name}&amp;quot; owner=&amp;quot;whx&amp;quot; organization=&amp;quot;whx-inc&amp;quot;/&amp;gt;
&amp;lt;dubbo:registry protocol=&amp;quot;zookeeper&amp;quot;">
<meta property="og:updated_time" content="2017-06-02T13:37:15.992Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dubbo学习-spring schema扩展">
<meta name="twitter:description" content="dubbo对spring的标签的扩展&amp;lt;dubbo:application name=&amp;quot;${dubbo.application.name}&amp;quot; owner=&amp;quot;whx&amp;quot; organization=&amp;quot;whx-inc&amp;quot;/&amp;gt;
&amp;lt;dubbo:registry protocol=&amp;quot;zookeeper&amp;quot;">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/2017/06/02/dubbo学习-spring-schema扩展/"/>

  <title> dubbo学习-spring schema扩展 | 学而后知不足 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">学而后知不足</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                dubbo学习-spring schema扩展
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-02T20:53:40+08:00" content="2017-06-02">
              2017-06-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/dubbo/" itemprop="url" rel="index">
                    <span itemprop="name">dubbo</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h4 id="dubbo对spring的标签的扩展"><a href="#dubbo对spring的标签的扩展" class="headerlink" title="dubbo对spring的标签的扩展"></a>dubbo对spring的标签的扩展</h4><pre><code>&lt;dubbo:application name=&quot;${dubbo.application.name}&quot; owner=&quot;whx&quot; organization=&quot;whx-inc&quot;/&gt;
&lt;dubbo:registry protocol=&quot;zookeeper&quot;
                address=&quot;${dubbo.registry.address}&quot;
                group=&quot;${dubbo.registry.group}&quot;
                file=&quot;${dubbo.registry.file}&quot;/&gt;

&lt;dubbo:annotation package=&quot;com.whx&quot;/&gt;

&lt;dubbo:consumer check=&quot;false&quot; retries=&quot;0&quot;/&gt;

&lt;dubbo:provider threads=&quot;600&quot; threadpool=&quot;fixed&quot; retries=&quot;0&quot; loadbalance=&quot;roundrobin&quot; accesslog=&quot;true&quot;/&gt;

&lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;${dubbo.protocol.dubbo.port}&quot; charset=&quot;utf-8&quot;/&gt;

&lt;dubbo:protocol name=&quot;hessian&quot; port=&quot;${jetty.port}&quot; server=&quot;jetty&quot; accesslog=&quot;true&quot;/&gt;
&lt;dubbo:protocol name=&quot;rest&quot; port=&quot;${dubbo.protocol.rest.port}&quot;
   keepalive=&quot;true&quot; server=&quot;netty&quot; 
   extension=&quot;com.whx.common.rest.FastJsonProvider,com.whx.common.rest.JsonExceptionMapper&quot; /&gt;

&lt;context:property-placeholder
        ignore-resource-not-found=&quot;false&quot;
        location=&quot;classpath*:application.properties,classpath*:redis.properties,classpath*:dubbo.properties,classpath*:kestrel.properties,classpath*:db.properties&quot; /&gt;
&lt;dubbo:monitor address=&quot;${dubbo.monitor.address}&quot; /&gt;
</code></pre><p>这些注解其实都是对spring标签的扩展，由spring的api扩展出来，方便我们不去读取xml，直接通过标签的方式加载为bean对象</p>
<pre><code>public class DubboNamespaceHandler extends NamespaceHandlerSupport {

static {
    Version.checkDuplicate(DubboNamespaceHandler.class);
}

public void init() {
    registerBeanDefinitionParser(&quot;application&quot;, new DubboBeanDefinitionParser(ApplicationConfig.class, true));
    registerBeanDefinitionParser(&quot;module&quot;, new DubboBeanDefinitionParser(ModuleConfig.class, true));
    registerBeanDefinitionParser(&quot;registry&quot;, new DubboBeanDefinitionParser(RegistryConfig.class, true));
    registerBeanDefinitionParser(&quot;monitor&quot;, new DubboBeanDefinitionParser(MonitorConfig.class, true));
    registerBeanDefinitionParser(&quot;provider&quot;, new DubboBeanDefinitionParser(ProviderConfig.class, true));
    registerBeanDefinitionParser(&quot;consumer&quot;, new DubboBeanDefinitionParser(ConsumerConfig.class, true));
    registerBeanDefinitionParser(&quot;protocol&quot;, new DubboBeanDefinitionParser(ProtocolConfig.class, true));
    registerBeanDefinitionParser(&quot;service&quot;, new DubboBeanDefinitionParser(ServiceBean.class, true));
    registerBeanDefinitionParser(&quot;reference&quot;, new DubboBeanDefinitionParser(ReferenceBean.class, false));
    registerBeanDefinitionParser(&quot;annotation&quot;, new DubboBeanDefinitionParser(AnnotationBean.class, true));
}
</code></pre><p>}</p>
<h4 id="spring-schema扩展实现"><a href="#spring-schema扩展实现" class="headerlink" title="spring schema扩展实现"></a>spring schema扩展实现</h4><h5 id="1-编写Bean类，此为业务类"><a href="#1-编写Bean类，此为业务类" class="headerlink" title="1.编写Bean类，此为业务类"></a>1.编写Bean类，此为业务类</h5><pre><code>public class People {

    private String id;
    private String name;
    private Integer age;

    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    @Override
    public String toString() {
        return &quot;People{&quot; +
                &quot;id=&apos;&quot; + id + &apos;\&apos;&apos; +
                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +
                &quot;, age=&quot; + age +
                &apos;}&apos;;
    }
}
</code></pre><h5 id="2-编写xsd文件-xsd文件中包含了Bean类的属性映射"><a href="#2-编写xsd文件-xsd文件中包含了Bean类的属性映射" class="headerlink" title="2.编写xsd文件 xsd文件中包含了Bean类的属性映射"></a>2.编写xsd文件 xsd文件中包含了Bean类的属性映射</h5><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
    &lt;xsd:schema
        xmlns=&quot;http://whx4j8.github.io/people&quot;
        xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;
        xmlns:beans=&quot;http://www.springframework.org/schema/beans&quot;
        targetNamespace=&quot;http://whx4j8.github.io/people&quot;
        elementFormDefault=&quot;qualified&quot;
        attributeFormDefault=&quot;unqualified&quot;&gt;

    &lt;xsd:import namespace=&quot;http://www.springframework.org/schema/beans&quot;/&gt;
    &lt;xsd:element name=&quot;people&quot;&gt;
        &lt;xsd:complexType&gt;
            &lt;xsd:complexContent&gt;
                &lt;xsd:extension base=&quot;beans:identifiedType&quot;&gt;
                    &lt;xsd:attribute name=&quot;name&quot; type=&quot;xsd:string&quot;/&gt;
                    &lt;xsd:attribute name=&quot;age&quot; type=&quot;xsd:int&quot;/&gt;
                &lt;/xsd:extension&gt;
            &lt;/xsd:complexContent&gt;
        &lt;/xsd:complexType&gt;
    &lt;/xsd:element&gt;

&lt;/xsd:schema&gt;
</code></pre><p>element name=”people” 代表people，spring会通过其内的配置项xsd:attribute在xml提示字段，类似xml提示</p>
<p>xmlns targetNamespace 代表对应的唯一命名空间</p>
<p>一般将xsd放到META-INF下</p>
<h5 id="3-编写NamespaceHandler-和-spring-schemas-映射配置文件"><a href="#3-编写NamespaceHandler-和-spring-schemas-映射配置文件" class="headerlink" title="3.编写NamespaceHandler 和 spring.schemas 映射配置文件"></a>3.编写NamespaceHandler 和 spring.schemas 映射配置文件</h5><p>registerBeanDefinitionParser(“people”, new PeopleBeanDefinitionParser());</p>
<p>当读取到people这个节点名时，使用PeopleBeanDefinitionParser类去解析，而不是仅仅将字段注入属性中。</p>
<pre><code>public class MyNamespaceHandler extends NamespaceHandlerSupport {

    @Override
    public void init() {
        registerBeanDefinitionParser(&quot;people&quot;, new PeopleBeanDefinitionParser());
    }

}
</code></pre><p>PeopleBeanDefinitionParser通过反射将xml中配置的值注入到生成的bean对象中。</p>
<pre><code>public class PeopleBeanDefinitionParser extends AbstractSingleBeanDefinitionParser {

    @Override
    protected Class&lt;?&gt; getBeanClass(Element element) {
        return People.class;
    }


    @Override
    protected void doParse(Element element, BeanDefinitionBuilder builder) {
        String name = element.getAttribute(&quot;name&quot;);
        String age = element.getAttribute(&quot;age&quot;);
        String id = element.getAttribute(&quot;id&quot;);

        if (!StringUtils.isEmpty(name)){
            builder.addPropertyValue(&quot;name&quot;,name);
        }

        if (!StringUtils.isEmpty(age)){
            builder.addPropertyValue(&quot;age&quot;,age);
        }

        if (!StringUtils.isEmpty(id)){
            builder.addPropertyValue(&quot;id&quot;,id);
        }

    }
}
</code></pre><h5 id="4-spring-handlers-和-spring-schemas"><a href="#4-spring-handlers-和-spring-schemas" class="headerlink" title="4.spring.handlers 和 spring.schemas"></a>4.spring.handlers 和 spring.schemas</h5><p>现在xml规范有了，xml解析器也有了，Bean对象也有了。</p>
<p>spring.handlers文件</p>
<pre><code>http\://whx4j8.github.io/people=com.whx.spring.MyNamespaceHandler
告诉spring当使用http\://whx4j8.github.io/people使用com.whx.spring.MyNamespaceHandler去配置解析
</code></pre><p>spring.schemas文件</p>
<pre><code>http\://whx4j8.github.io/people.xsd=META-INF/people.xsd
告诉spring去加载那些xsd文件
</code></pre><h5 id="5-application-xml"><a href="#5-application-xml" class="headerlink" title="5.application.xml"></a>5.application.xml</h5><pre><code>&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:whx=&quot;http://whx4j8.github.io/people&quot;
       xsi:schemaLocation=&quot;
                http://www.springframework.org/schema/beans
                http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
                http://whx4j8.github.io/people
                http://whx4j8.github.io/people.xsd&quot;&gt;

    &lt;whx:people id=&quot;people&quot; name=&quot;whx&quot; age=&quot;22&quot;&gt;&lt;/whx:people&gt;
&lt;/beans&gt;
</code></pre><p>xmlns:whx=”<a href="http://whx4j8.github.io/people" target="_blank" rel="external">http://whx4j8.github.io/people</a>“ 为该schema命名为whx，在下面的xml直接使用whx即可</p>
<h5 id="6-使用"><a href="#6-使用" class="headerlink" title="6.使用"></a>6.使用</h5><pre><code>public static void main(String[] args){

    ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;application.xml&quot;);
    People people = (People) ctx.getBean(&quot;people&quot;);
    System.out.println(people.toString());

}
</code></pre><p>输出People{id=’people’, name=’whx’, age=22}</p>
<h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><p>dubbo源码解析</p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/spring/" rel="tag">#spring</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/23/关于dubbo-monitor的扩展-监控报表/" rel="next" title="关于dubbo monitor的扩展-监控报表">
                <i class="fa fa-chevron-left"></i> 关于dubbo monitor的扩展-监控报表
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="whx4J8" />
          <p class="site-author-name" itemprop="name">whx4J8</p>
          <p class="site-description motion-element" itemprop="description">github.com/whx4J8</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">24</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#dubbo对spring的标签的扩展"><span class="nav-number">1.</span> <span class="nav-text">dubbo对spring的标签的扩展</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#spring-schema扩展实现"><span class="nav-number">2.</span> <span class="nav-text">spring schema扩展实现</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-编写Bean类，此为业务类"><span class="nav-number">2.1.</span> <span class="nav-text">1.编写Bean类，此为业务类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-编写xsd文件-xsd文件中包含了Bean类的属性映射"><span class="nav-number">2.2.</span> <span class="nav-text">2.编写xsd文件 xsd文件中包含了Bean类的属性映射</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-编写NamespaceHandler-和-spring-schemas-映射配置文件"><span class="nav-number">2.3.</span> <span class="nav-text">3.编写NamespaceHandler 和 spring.schemas 映射配置文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-spring-handlers-和-spring-schemas"><span class="nav-number">2.4.</span> <span class="nav-text">4.spring.handlers 和 spring.schemas</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-application-xml"><span class="nav-number">2.5.</span> <span class="nav-text">5.application.xml</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-使用"><span class="nav-number">2.6.</span> <span class="nav-text">6.使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#参考"><span class="nav-number">2.7.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">whx4J8</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  
  

  

  

</body>
</html>
